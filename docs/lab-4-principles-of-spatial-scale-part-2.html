<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title></title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lab-3-principles-of-spatial-scale-part-1.html"/>
<link rel="next" href="lab-5-modeling-neighborhoods.html"/>
<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro</a></li>
<li class="chapter" data-level="2" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html"><i class="fa fa-check"></i><b>2</b> “Lab 1. Intro to Spatial Data”</a><ul>
<li class="chapter" data-level="2.1" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#the-bolded-sentences-need-to-be-made-more-general-as-they-are-specific-to-a-particular-version-of-the-software"><i class="fa fa-check"></i><b>2.1</b> The bolded sentences need to be made more general, as they are specific to a particular version of the software</a></li>
<li class="chapter" data-level="2.2" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#overview"><i class="fa fa-check"></i><b>2.2</b> Overview</a></li>
<li class="chapter" data-level="2.3" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#research-question"><i class="fa fa-check"></i><b>2.3</b> Research Question</a></li>
<li class="chapter" data-level="2.4" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#environment-setup"><i class="fa fa-check"></i><b>2.4</b> Environment Setup</a><ul>
<li class="chapter" data-level="2.4.1" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#plugin"><i class="fa fa-check"></i><b>2.4.1</b> Plugin</a></li>
<li class="chapter" data-level="2.4.2" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#basemap"><i class="fa fa-check"></i><b>2.4.2</b> Basemap</a></li>
<li class="chapter" data-level="2.4.3" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#file-management"><i class="fa fa-check"></i><b>2.4.3</b> File Management</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#download-data"><i class="fa fa-check"></i><b>2.5</b> Download Data</a></li>
<li class="chapter" data-level="2.6" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#transform-data"><i class="fa fa-check"></i><b>2.6</b> Transform Data</a></li>
<li class="chapter" data-level="2.7" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#set-new-project-space"><i class="fa fa-check"></i><b>2.7</b> Set New Project Space</a></li>
<li class="chapter" data-level="2.8" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#style-layers"><i class="fa fa-check"></i><b>2.8</b> Style Layers</a></li>
<li class="chapter" data-level="2.9" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#calculate-and-style-buffers"><i class="fa fa-check"></i><b>2.9</b> Calculate and Style Buffers</a></li>
<li class="chapter" data-level="2.10" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#add-labeled-community-areas"><i class="fa fa-check"></i><b>2.10</b> Add labeled community areas</a></li>
<li class="chapter" data-level="2.11" data-path="lab-1-intro-to-spatial-data.html"><a href="lab-1-intro-to-spatial-data.html#compose-a-map"><i class="fa fa-check"></i><b>2.11</b> Compose a Map</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html"><i class="fa fa-check"></i><b>3</b> “Lab 2. Principles of Cartographic Design”</a><ul>
<li class="chapter" data-level="3.1" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#overview-1"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#research-question-1"><i class="fa fa-check"></i><b>3.2</b> Research Question</a></li>
<li class="chapter" data-level="3.3" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#environment-setup-1"><i class="fa fa-check"></i><b>3.3</b> Environment Setup</a></li>
<li class="chapter" data-level="3.4" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#download-data-1"><i class="fa fa-check"></i><b>3.4</b> Download Data</a></li>
<li class="chapter" data-level="3.5" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#inspect-data"><i class="fa fa-check"></i><b>3.5</b> Inspect Data</a></li>
<li class="chapter" data-level="3.6" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#open-in-geoda"><i class="fa fa-check"></i><b>3.6</b> Open in GeoDa</a><ul>
<li class="chapter" data-level="3.6.1" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#merge-data"><i class="fa fa-check"></i><b>3.6.1</b> Merge data</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#data-classification"><i class="fa fa-check"></i><b>3.7</b> Data Classification</a></li>
<li class="chapter" data-level="3.8" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#choropleth-mapping-in-geoda"><i class="fa fa-check"></i><b>3.8</b> Choropleth Mapping in GeoDa</a></li>
<li class="chapter" data-level="3.9" data-path="lab-2-principles-of-cartographic-design.html"><a href="lab-2-principles-of-cartographic-design.html#next-steps"><i class="fa fa-check"></i><b>3.9</b> Next Steps</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html"><i class="fa fa-check"></i><b>4</b> “Lab 3. Principles of Spatial Scale, Part 1”</a><ul>
<li class="chapter" data-level="4.1" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#overview-2"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#research-question-2"><i class="fa fa-check"></i><b>4.2</b> Research Question</a></li>
<li class="chapter" data-level="4.3" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#environment-setup-2"><i class="fa fa-check"></i><b>4.3</b> Environment Setup</a></li>
<li class="chapter" data-level="4.4" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#download-data-2"><i class="fa fa-check"></i><b>4.4</b> Download Data</a><ul>
<li class="chapter" data-level="4.4.1" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#coal-mining-job-data"><i class="fa fa-check"></i><b>4.4.1</b> Coal Mining Job Data</a></li>
<li class="chapter" data-level="4.4.2" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#county-boundary-file-data"><i class="fa fa-check"></i><b>4.4.2</b> County Boundary File Data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#merge-data-1"><i class="fa fa-check"></i><b>4.5</b> Merge Data</a></li>
<li class="chapter" data-level="4.6" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#explore-data"><i class="fa fa-check"></i><b>4.6</b> Explore Data</a></li>
<li class="chapter" data-level="4.7" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#add-another-time-period"><i class="fa fa-check"></i><b>4.7</b> Add Another Time Period</a></li>
<li class="chapter" data-level="4.8" data-path="lab-3-principles-of-spatial-scale-part-1.html"><a href="lab-3-principles-of-spatial-scale-part-1.html#installations-for-next-week"><i class="fa fa-check"></i><b>4.8</b> Installations for Next Week</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html"><i class="fa fa-check"></i><b>5</b> “Lab 4. Principles of Spatial Scale, Part 2”</a><ul>
<li class="chapter" data-level="5.1" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#overview-3"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#research-question-3"><i class="fa fa-check"></i><b>5.2</b> Research Question</a></li>
<li class="chapter" data-level="5.3" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#environment-setup-3"><i class="fa fa-check"></i><b>5.3</b> Environment Setup</a></li>
<li class="chapter" data-level="5.4" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#need-for-finer-data"><i class="fa fa-check"></i><b>5.4</b> Need for finer data</a></li>
<li class="chapter" data-level="5.5" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#census-data"><i class="fa fa-check"></i><b>5.5</b> Census Data</a><ul>
<li class="chapter" data-level="5.5.1" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#working-directory-setup"><i class="fa fa-check"></i><b>5.5.1</b> Working Directory Setup</a></li>
<li class="chapter" data-level="5.5.2" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#load-libraries"><i class="fa fa-check"></i><b>5.5.2</b> Load Libraries</a></li>
<li class="chapter" data-level="5.5.3" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#load-data"><i class="fa fa-check"></i><b>5.5.3</b> Load Data</a></li>
<li class="chapter" data-level="5.5.4" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#view-data"><i class="fa fa-check"></i><b>5.5.4</b> View Data</a></li>
<li class="chapter" data-level="5.5.5" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#subset-data"><i class="fa fa-check"></i><b>5.5.5</b> Subset Data</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#merge-data-to-master"><i class="fa fa-check"></i><b>5.6</b> Merge data to Master</a></li>
<li class="chapter" data-level="5.7" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#mapping-in-r"><i class="fa fa-check"></i><b>5.7</b> Mapping in R</a><ul>
<li class="chapter" data-level="5.7.1" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#load-packages"><i class="fa fa-check"></i><b>5.7.1</b> Load packages</a></li>
<li class="chapter" data-level="5.7.2" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#view-palette-options"><i class="fa fa-check"></i><b>5.7.2</b> View palette options</a></li>
<li class="chapter" data-level="5.7.3" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#basic-tmap-functions"><i class="fa fa-check"></i><b>5.7.3</b> Basic tmap functions</a></li>
<li class="chapter" data-level="5.7.4" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#set-color-palette"><i class="fa fa-check"></i><b>5.7.4</b> Set color palette</a></li>
<li class="chapter" data-level="5.7.5" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#classify-data"><i class="fa fa-check"></i><b>5.7.5</b> Classify data</a></li>
<li class="chapter" data-level="5.7.6" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#customize-maps"><i class="fa fa-check"></i><b>5.7.6</b> Customize Maps</a></li>
<li class="chapter" data-level="5.7.7" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#facet-mapping"><i class="fa fa-check"></i><b>5.7.7</b> Facet mapping</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#using-a-census-api"><i class="fa fa-check"></i><b>5.8</b> Using a Census API</a><ul>
<li class="chapter" data-level="5.8.1" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#workspace-setup"><i class="fa fa-check"></i><b>5.8.1</b> Workspace Setup</a></li>
<li class="chapter" data-level="5.8.2" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#load-libraries-1"><i class="fa fa-check"></i><b>5.8.2</b> Load libraries</a></li>
<li class="chapter" data-level="5.8.3" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#activate-your-api-key"><i class="fa fa-check"></i><b>5.8.3</b> Activate your API key</a></li>
<li class="chapter" data-level="5.8.4" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#extract-census-data"><i class="fa fa-check"></i><b>5.8.4</b> Extract Census data</a></li>
<li class="chapter" data-level="5.8.5" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#access-census-estimates"><i class="fa fa-check"></i><b>5.8.5</b> Access census estimates</a></li>
<li class="chapter" data-level="5.8.6" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#access-merged-spatial-file"><i class="fa fa-check"></i><b>5.8.6</b> Access merged spatial file</a></li>
<li class="chapter" data-level="5.8.7" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#plot-data"><i class="fa fa-check"></i><b>5.8.7</b> Plot data</a></li>
<li class="chapter" data-level="5.8.8" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#rinse-and-repeat"><i class="fa fa-check"></i><b>5.8.8</b> Rinse and Repeat</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#scale-of-coal-mining"><i class="fa fa-check"></i><b>5.9</b> Scale of Coal Mining</a><ul>
<li class="chapter" data-level="5.9.1" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#extract-data"><i class="fa fa-check"></i><b>5.9.1</b> Extract Data</a></li>
<li class="chapter" data-level="5.9.2" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#map-data"><i class="fa fa-check"></i><b>5.9.2</b> Map Data</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#interpretation"><i class="fa fa-check"></i><b>5.10</b> Interpretation</a></li>
<li class="chapter" data-level="5.11" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#appendix"><i class="fa fa-check"></i><b>5.11</b> Appendix</a><ul>
<li class="chapter" data-level="5.11.1" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#write-to-csv"><i class="fa fa-check"></i><b>5.11.1</b> Write to CSV</a></li>
<li class="chapter" data-level="5.11.2" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#write-to-shp"><i class="fa fa-check"></i><b>5.11.2</b> Write to SHP</a></li>
<li class="chapter" data-level="5.11.3" data-path="lab-4-principles-of-spatial-scale-part-2.html"><a href="lab-4-principles-of-spatial-scale-part-2.html#census-data-access"><i class="fa fa-check"></i><b>5.11.3</b> Census Data Access</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html"><i class="fa fa-check"></i><b>6</b> “Lab 5. Modeling Neighborhoods”</a><ul>
<li class="chapter" data-level="6.1" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#overview-4"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#research-question-4"><i class="fa fa-check"></i><b>6.2</b> Research Question</a></li>
<li class="chapter" data-level="6.3" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#environment-setup-4"><i class="fa fa-check"></i><b>6.3</b> Environment Setup</a></li>
<li class="chapter" data-level="6.4" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#clean-wrangle-data"><i class="fa fa-check"></i><b>6.4</b> Clean &amp; Wrangle Data</a><ul>
<li class="chapter" data-level="6.4.1" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#load-csv-with-fread"><i class="fa fa-check"></i><b>6.4.1</b> Load CSV with <code>fread</code></a></li>
<li class="chapter" data-level="6.4.2" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#identify-unique-code"><i class="fa fa-check"></i><b>6.4.2</b> Identify <code>unique</code> Code</a></li>
<li class="chapter" data-level="6.4.3" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#subset-data-1"><i class="fa fa-check"></i><b>6.4.3</b> Subset Data</a></li>
<li class="chapter" data-level="6.4.4" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#inspect-data-1"><i class="fa fa-check"></i><b>6.4.4</b> Inspect Data</a></li>
<li class="chapter" data-level="6.4.5" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#save-cleaned-data"><i class="fa fa-check"></i><b>6.4.5</b> Save Cleaned Data</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#convert-csv-to-points"><i class="fa fa-check"></i><b>6.5</b> Convert CSV to Points</a><ul>
<li class="chapter" data-level="6.5.1" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#identify-xy-locations"><i class="fa fa-check"></i><b>6.5.1</b> Identify X,Y locations</a></li>
<li class="chapter" data-level="6.5.2" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#check-longlat-structure"><i class="fa fa-check"></i><b>6.5.2</b> Check long/lat structure</a></li>
<li class="chapter" data-level="6.5.3" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#id-missing-data"><i class="fa fa-check"></i><b>6.5.3</b> ID Missing Data</a></li>
<li class="chapter" data-level="6.5.4" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#remove-na-values"><i class="fa fa-check"></i><b>6.5.4</b> Remove NA values</a></li>
<li class="chapter" data-level="6.5.5" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#convert-inspect"><i class="fa fa-check"></i><b>6.5.5</b> Convert &amp; Inspect</a></li>
<li class="chapter" data-level="6.5.6" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#save-clean-data"><i class="fa fa-check"></i><b>6.5.6</b> Save Clean Data</a></li>
<li class="chapter" data-level="6.5.7" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#rinse-and-repeat-1"><i class="fa fa-check"></i><b>6.5.7</b> Rinse and Repeat</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#standardize-crs"><i class="fa fa-check"></i><b>6.6</b> Standardize CRS</a><ul>
<li class="chapter" data-level="6.6.1" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#load-inspect"><i class="fa fa-check"></i><b>6.6.1</b> Load &amp; Inspect</a></li>
<li class="chapter" data-level="6.6.2" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#overlay-points-polygons"><i class="fa fa-check"></i><b>6.6.2</b> Overlay Points &amp; Polygons</a></li>
<li class="chapter" data-level="6.6.3" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#check-crs"><i class="fa fa-check"></i><b>6.6.3</b> Check CRS</a></li>
<li class="chapter" data-level="6.6.4" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#transform-crs"><i class="fa fa-check"></i><b>6.6.4</b> Transform CRS</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#point-in-polygon"><i class="fa fa-check"></i><b>6.7</b> Point-in-Polygon</a><ul>
<li class="chapter" data-level="6.7.1" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#spatial-join"><i class="fa fa-check"></i><b>6.7.1</b> Spatial Join</a></li>
<li class="chapter" data-level="6.7.2" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#count-crimes-per-tract"><i class="fa fa-check"></i><b>6.7.2</b> Count Crimes per Tract</a></li>
<li class="chapter" data-level="6.7.3" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#rename-column-names"><i class="fa fa-check"></i><b>6.7.3</b> Rename Column Names</a></li>
<li class="chapter" data-level="6.7.4" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#merge-data-2"><i class="fa fa-check"></i><b>6.7.4</b> Merge Data</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#conclusions"><i class="fa fa-check"></i><b>6.8</b> Conclusions</a><ul>
<li class="chapter" data-level="6.8.1" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#visualize-ouput"><i class="fa fa-check"></i><b>6.8.1</b> Visualize Ouput</a></li>
<li class="chapter" data-level="6.8.2" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#save-your-shapefile"><i class="fa fa-check"></i><b>6.8.2</b> Save your Shapefile</a></li>
<li class="chapter" data-level="6.8.3" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#interpretations"><i class="fa fa-check"></i><b>6.8.3</b> Interpretations</a></li>
<li class="chapter" data-level="6.8.4" data-path="lab-5-modeling-neighborhoods.html"><a href="lab-5-modeling-neighborhoods.html#compare-across-cities"><i class="fa fa-check"></i><b>6.8.4</b> Compare Across Cities</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab-4.-principles-of-spatial-scale-part-2" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> “Lab 4. Principles of Spatial Scale, Part 2”</h1>
<div id="overview-3" class="section level2">
<h2><span class="header-section-number">5.1</span> Overview</h2>
<p>In this practical, we will continue to explore how coal mining impacts West Virginia in a contemporary context. Extending from our work last week exploring county-level variations, this week’s objectives will be to:</p>
<ul>
<li>learn some basics of R</li>
<li>wrangle Census data</li>
<li>access data through the Web</li>
<li>compare data between sources &amp; scales</li>
</ul>
</div>
<div id="research-question-3" class="section level2">
<h2><span class="header-section-number">5.2</span> Research Question</h2>
<p>We have been focusing on coal mining jobs at the county-scale. This is partly due to a data limitation, as we know the exact number of jobs for coal-mining at the county level. However, is the scale of coal-mining at the county level, or below? Will there be more variation at a smaller area of resolution? Are jobs equally distributed throughout the county, or will they tend to clump in certain areas within a county – and if so, why would that be the case?</p>
<p>In other words: Is coal mining spatially homogeneous throughout the state, or throughout different counties – or is it spatially heterogeneous, with “clumping” behaviors? If there is a spatially heterogeneous pattern, what may tie coal mining jobs to a certain place? Is there a pattern of spatial dependence?</p>
</div>
<div id="environment-setup-3" class="section level2">
<h2><span class="header-section-number">5.3</span> Environment Setup</h2>
<p>For this lab, you’ll need to have R and RStudio downloaded and installed on your system. You should be able to install packages, and have very basic familiarity with R following <a href="https://learn.datacamp.com/courses/free-introduction-to-r">intro-level tutorials</a> provided through <a href="https://rspatial.org/intr/1-introduction.html">installation guides</a>. You should also know how to find the address to a folder on your computer system.</p>
<p>We will work with the following libraries, so please be sure to install:</p>
<ul>
<li>sf</li>
<li>tmap</li>
<li>RColorBrewer</li>
<li>tidyverse</li>
<li>tidycensus</li>
</ul>
<p>Coding snippets from <a href="https://walkerke.github.io/" class="uri">https://walkerke.github.io/</a> and <a href="https://data.cdrc.ac.uk/tutorial/an-introduction-to-spatial-data-analysis-and-visualisation-in-r">https://data.cdrc.ac.uk</a> were used in the development of this lab practical.</p>
</div>
<div id="need-for-finer-data" class="section level2">
<h2><span class="header-section-number">5.4</span> Need for finer data</h2>
<p>In order to examine this further, we need to look at data at a smaller areal resolution. While we don’t have an exact number of coal mining jobs below county, the American Community Survey (ACS) does provide an approximation of mining grouped within an industry variable at the census-tract level. Census tracts are smaller units used by the Census to track populations, and encompass a population between 2,500 to 8,000 people. When using tract-level files from the ACS, it is recommended to only use 5-year estimates because of the large margins of error in smaller year samples.</p>
</div>
<div id="census-data" class="section level2">
<h2><span class="header-section-number">5.5</span> Census Data</h2>
<p>The mining data we used last week indicated <em>exact</em> counts of employees working within the coal mining industry at the county level, by year. If we wanted to find similar data using the Census, the closest variable available would be Mining jobs as part of the industry category “Agriculture, forestry, fishing and hunting, and mining” at the county or tract level within the American Community Survey (ACS 5-year estimate). Before we explore this data at the tract level, let’s first compare the county-level data between sources: Bureau of Labor Statistics (BLS) and ACS.</p>
<p>We will first work with ACS data provided as a <code>CSV</code> file format, to be joined to the master West Virginia county <code>shapefile</code> we generated last week.</p>
<div id="working-directory-setup" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Working Directory Setup</h3>
<p>To do this, we first need to ensure we have a working directory where your code and data reside. Make sure that your R script, CSV file provided, and WV county shapefile are all in the same folder. Identify the address to this folder.</p>
<p>Now we can set up our working directory. Again, this will be the folder on your computer system where you are storing script and data for this lab. Ensure that you are working from the script from this folder.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set working directory</span>
<span class="co">#setwd(&quot;/Users/maryniakolak/Desktop/WVCoal&quot;)</span></code></pre></div>
</div>
<div id="load-libraries" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Load Libraries</h3>
<p>Before loading our data, we will need to load the required packages. While we can load a CSV using base R capabilities, we need the <code>sf</code> package to load spatial data.</p>
<p>If you have not installed <code>sf</code>, do so now. You can uncomment the line of code to install, but then re-comment it so you don’t install the package more than once. We also load the <code>tidyverse</code> package to enable some useful data wrangling tools.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;sf&quot;)</span>
<span class="kw">library</span>(sf)</code></pre></div>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## ── Attaching packages ──────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.0     ✓ purrr   0.3.4
## ✓ tibble  3.0.1     ✓ dplyr   0.8.5
## ✓ tidyr   1.0.3     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ─────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div id="load-data" class="section level3">
<h3><span class="header-section-number">5.5.3</span> Load Data</h3>
<p>Next, load the census data and read in the shapefile of your counties file. While it reads in as a shapefile, the data structure gets changed to a “simple features” dataset that inludes geometry as an additional column. This is a key feature of the <code>sf</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load new census data you plan to join.</span>
Census.Data &lt;-<span class="kw">read.csv</span>(<span class="st">&quot;ACS_15_5YR_DP03.csv&quot;</span>)

<span class="co"># Load the output area shapefiles</span>
County.Areas&lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;WV_Counties.shp&quot;</span>)</code></pre></div>
<pre><code>## Reading layer `WV_Counties&#39; from data source `/Users/HIPark/Documents/micrometcalf/Intro2GIS/book/WV_Counties.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 55 features and 46 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 355916.7 ymin: 4117439 xmax: 782847.1 ymax: 4498773
## CRS:            26917</code></pre>
</div>
<div id="view-data" class="section level3">
<h3><span class="header-section-number">5.5.4</span> View Data</h3>
<p>We can quickly view the attributes. One way is to use the <code>glimpse</code> function. Uncomment this line in your script, and view the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># View the attributes associated with each county</span>
<span class="kw">glimpse</span>(County.Areas)</code></pre></div>
<pre><code>## Rows: 55
## Columns: 47
## $ FIPSSTCO   &lt;chr&gt; &quot;54109&quot;, &quot;54107&quot;, &quot;54105&quot;, &quot;54103&quot;, &quot;54101&quot;, &quot;54099&quot;, &quot;540…
## $ STATE      &lt;chr&gt; &quot;West Virginia&quot;, &quot;West Virginia&quot;, &quot;West Virginia&quot;, &quot;West V…
## $ COUNTY     &lt;chr&gt; &quot;Wyoming&quot;, &quot;Wood&quot;, &quot;Wirt&quot;, &quot;Wetzel&quot;, &quot;Webster&quot;, &quot;Wayne&quot;, &quot;…
## $ POP2000    &lt;int&gt; 25708, 87986, 5873, 17693, 9719, 42903, 23404, 9592, 7321,…
## $ WHITE      &lt;int&gt; 25345, 85627, 5788, 17502, 9639, 42382, 22981, 9530, 7237,…
## $ BLACK      &lt;int&gt; 161, 887, 17, 15, 1, 54, 144, 2, 5, 134, 280, 34, 14, 302,…
## $ AMERI_ES   &lt;int&gt; 31, 188, 12, 17, 7, 99, 39, 5, 14, 31, 33, 32, 28, 46, 147…
## $ ASIAN      &lt;int&gt; 21, 448, 6, 57, 6, 86, 72, 8, 1, 27, 12, 35, 13, 106, 568,…
## $ HAWN_PI    &lt;int&gt; 0, 35, 0, 4, 1, 8, 3, 1, 9, 6, 5, 0, 0, 4, 13, 11, 5, 0, 0…
## $ OTHER      &lt;int&gt; 19, 124, 6, 5, 1, 35, 30, 3, 7, 10, 13, 29, 11, 45, 99, 67…
## $ MULT_RACE  &lt;int&gt; 131, 677, 44, 93, 64, 239, 135, 43, 48, 102, 103, 93, 71, …
## $ HISPANIC   &lt;int&gt; 135, 514, 18, 74, 36, 202, 137, 41, 18, 95, 71, 104, 49, 1…
## $ MALES      &lt;int&gt; 12649, 42246, 2939, 8586, 4783, 20993, 11354, 4686, 3570, …
## $ FEMALES    &lt;int&gt; 13059, 45740, 2934, 9107, 4936, 21910, 12050, 4906, 3751, …
## $ AGE_UNDER5 &lt;int&gt; 1467, 5089, 329, 1007, 500, 2471, 1248, 503, 353, 864, 604…
## $ AGE_5_17   &lt;int&gt; 4291, 15139, 1163, 3197, 1732, 7551, 4030, 1728, 1204, 282…
## $ AGE_18_21  &lt;int&gt; 1257, 4181, 262, 715, 456, 2257, 2092, 378, 294, 749, 567,…
## $ AGE_22_29  &lt;int&gt; 2535, 8122, 514, 1463, 887, 4288, 2199, 794, 564, 1496, 11…
## $ AGE_30_39  &lt;int&gt; 3253, 12383, 894, 2348, 1222, 5882, 2945, 1268, 1024, 2342…
## $ AGE_40_49  &lt;int&gt; 4648, 13642, 903, 2699, 1579, 6292, 3446, 1523, 1078, 2565…
## $ AGE_50_64  &lt;int&gt; 4671, 15822, 1045, 3403, 1861, 7751, 3995, 1819, 1490, 271…
## $ AGE_65_UP  &lt;int&gt; 3586, 13608, 763, 2861, 1482, 6411, 3449, 1579, 1314, 2539…
## $ MED_AGE    &lt;dbl&gt; 40.1, 39.3, 37.9, 40.4, 40.4, 38.4, 37.4, 40.8, 42.0, 39.1…
## $ MED_AGE_M  &lt;dbl&gt; 39.2, 38.0, 37.1, 39.4, 39.6, 37.0, 36.4, 40.3, 40.8, 37.7…
## $ MED_AGE_F  &lt;dbl&gt; 41.0, 40.6, 38.6, 41.5, 41.2, 39.6, 38.4, 41.3, 43.2, 40.5…
## $ HOUSEHOLDS &lt;int&gt; 10454, 36275, 2284, 7164, 4010, 17239, 8972, 3836, 3052, 6…
## $ AVE_HH_SZ  &lt;dbl&gt; 2.45, 2.39, 2.56, 2.45, 2.41, 2.48, 2.45, 2.47, 2.35, 2.47…
## $ HSEHLD_1_M &lt;int&gt; 1046, 3856, 229, 723, 467, 1654, 905, 350, 318, 658, 693, …
## $ HSEHLD_1_F &lt;int&gt; 1501, 5976, 277, 1118, 597, 2501, 1354, 538, 512, 952, 914…
## $ MARHH_CHD  &lt;int&gt; 2493, 7682, 624, 1643, 866, 4090, 2130, 904, 657, 1466, 10…
## $ MARHH_NO_C &lt;int&gt; 3710, 12022, 780, 2491, 1355, 6112, 3088, 1450, 1112, 2099…
## $ MHH_CHILD  &lt;int&gt; 198, 664, 56, 152, 91, 285, 185, 72, 53, 134, 106, 135, 74…
## $ FHH_CHILD  &lt;int&gt; 545, 2275, 123, 372, 239, 997, 478, 185, 115, 355, 262, 31…
## $ FAMILIES   &lt;int&gt; 7705, 24898, 1700, 5080, 2816, 12648, 6353, 2833, 2121, 44…
## $ AVE_FAM_SZ &lt;dbl&gt; 2.89, 2.88, 2.97, 2.92, 2.89, 2.92, 2.92, 2.89, 2.84, 2.95…
## $ HSE_UNITS  &lt;int&gt; 11698, 39785, 3266, 8313, 5273, 19107, 10751, 4780, 4634, …
## $ URBAN      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ RURAL      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ VACANT     &lt;int&gt; 1244, 3510, 982, 1149, 1263, 1868, 1779, 944, 1582, 805, 1…
## $ OWNER_OCC  &lt;int&gt; 8713, 26609, 1898, 5625, 3167, 13466, 6883, 3209, 2520, 50…
## $ RENTER_OCC &lt;int&gt; 1741, 9666, 386, 1539, 843, 3773, 2089, 627, 532, 1287, 11…
## $ Mines15    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 22…
## $ AveEmp15   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 17…
## $ Wages15    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 13…
## $ AveWkWg15  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 14…
## $ WgEmp15    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 77…
## $ geometry   &lt;POLYGON [m]&gt; POLYGON ((478582 4150782, 4..., POLYGON ((463072.1…</code></pre>
<p>We can also use the <code>head()</code> function, which shows the top 5 rows. Uncomment this in your script, and view the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># View the attributes associated with each county</span>
<span class="co"># head(Census.Data)</span></code></pre></div>
<p>If we want to see the dimensions of the data, we can use the <code>dim()</code> function. I also like the <code>str()</code> function as it gives an overview of what type of data we have from a data structure perspective. I comment out the <code>str()</code> function here as it generates a very long output, but please try for yourself!</p>
<p>From either of these we can see that there 55 observations (counties), and 551 variables. In other words, 55 rows x 551 columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># View the attributes associated with each county</span>
<span class="kw">dim</span>(Census.Data)</code></pre></div>
<pre><code>## [1]  55 551</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#str(Census.Data)</span></code></pre></div>
</div>
<div id="subset-data" class="section level3">
<h3><span class="header-section-number">5.5.5</span> Subset Data</h3>
<p>This ACS dataset – a raw file from the <em>DP03: Selected Economic Characteristics</em> summary profile – includes a lot of variables. To work with this we need to know exactly what variabes we need. You would need the metadata document that comes with the summary profile to identify that. In this lab, I will tell you which variables we’re interested in.</p>
<ul>
<li><p>HC03_VC50: Percent; INDUSTRY - Civilian employed population 16 years and over - Agriculture, forestry, fishing and hunting, and mining</p></li>
<li><p>HC01_VC85: Estimate; INCOME AND BENEFITS (IN 2010 INFLATION- ADJUSTED DOLLARS) - Median household income (dollars).</p></li>
</ul>
<p>In other words, we need to generate a subset of the raw ACS file to include the unique numerical County geographic ID, and rename the variables of interest.</p>
<ul>
<li>County ID -&gt; named “GEO.id2” in dataset</li>
<li>HC03_VC50 -&gt; rename “AgFHM15”</li>
<li>HC01_VC85 -&gt; rename “MedInc15”</li>
</ul>
<p>Let’s further subset the data to make a new, cleaner dataset. We first generate a list of variables that we want to keep. Note that “GEO.id2” is the unique code that indicates a county. We will use this as our “key” to merge with our master spatial file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">var &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;GEO.id2&quot;</span>,<span class="st">&quot;HC01_VC85&quot;</span>,<span class="st">&quot;HC03_VC50&quot;</span>)</code></pre></div>
<p>Next, we extract only the variables of interest from the ACS dataset. We call this new object “Census.Subset.” View the data to ensure you’ve subset correctly.</p>
<p>Also note that there are multiple ways to subset data in R – here we use a simple base R approach. The <code>tidyverse</code> package offers even more elegant options.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Census.Subset&lt;-<span class="st"> </span>(Census.Data[var])
<span class="kw">glimpse</span>(Census.Subset)</code></pre></div>
<pre><code>## Rows: 55
## Columns: 3
## $ GEO.id2   &lt;int&gt; 54001, 54003, 54005, 54007, 54009, 54011, 54013, 54015, 540…
## $ HC01_VC85 &lt;int&gt; 37066, 55239, 39958, 32750, 46215, 38344, 35568, 31325, 399…
## $ HC03_VC50 &lt;dbl&gt; 6.2, 1.2, 23.4, 10.5, 1.7, 1.0, 12.5, 10.7, 16.7, 8.3, 8.5,…</code></pre>
<p>Next, we rename the second and third columns (identified as 2 through 3) using new names. Again, there are many ways to do this in R – this is just one approach.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(Census.Subset)[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MedInc15&quot;</span>, <span class="st">&quot;AgMnJb15&quot;</span>)
<span class="kw">glimpse</span>(Census.Subset)</code></pre></div>
<pre><code>## Rows: 55
## Columns: 3
## $ GEO.id2  &lt;int&gt; 54001, 54003, 54005, 54007, 54009, 54011, 54013, 54015, 5401…
## $ MedInc15 &lt;int&gt; 37066, 55239, 39958, 32750, 46215, 38344, 35568, 31325, 3997…
## $ AgMnJb15 &lt;dbl&gt; 6.2, 1.2, 23.4, 10.5, 1.7, 1.0, 12.5, 10.7, 16.7, 8.3, 8.5, …</code></pre>
</div>
</div>
<div id="merge-data-to-master" class="section level2">
<h2><span class="header-section-number">5.6</span> Merge data to Master</h2>
<p>Now that you’ve cleaned and named the census data showing our mining proxies, we can merge to our Master spatial file.</p>
<p>Note that we are joining using key “FIPSSTCO” from the county shapefile, and “GEO.id2” from the census dataset. Look at the data to make sure it joined correctly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Joins data to the shapefile</span>
WV_county &lt;-<span class="st"> </span><span class="kw">merge</span>(County.Areas, Census.Subset, <span class="dt">by.x=</span><span class="st">&quot;FIPSSTCO&quot;</span>, <span class="dt">by.y=</span><span class="st">&quot;GEO.id2&quot;</span>)
<span class="kw">head</span>(WV_county)</code></pre></div>
<pre><code>## Simple feature collection with 6 features and 48 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 368368.2 ymin: 4179711 xmax: 773040.2 ymax: 4472141
## CRS:            26917
##   FIPSSTCO         STATE   COUNTY POP2000 WHITE BLACK AMERI_ES ASIAN HAWN_PI
## 1    54001 West Virginia  Barbour   15557 15147    77      111    40       3
## 2    54003 West Virginia Berkeley   75905 70392  3558      186   350      17
## 3    54005 West Virginia    Boone   25535 25160   167       31    18       4
## 4    54007 West Virginia  Braxton   14702 14411   101       51    16       7
## 5    54009 West Virginia   Brooke   25447 24913   216       25    87       9
## 6    54011 West Virginia   Cabell   96784 90370  4150      174   749      38
##   OTHER MULT_RACE HISPANIC MALES FEMALES AGE_UNDER5 AGE_5_17 AGE_18_21
## 1    19       160       73  7646    7911        825     2752       928
## 2   428       974     1156 37784   38121       5024    14505      3558
## 3    17       138      117 12471   13064       1608     4317      1264
## 4    12       104       65  7444    7258        779     2567       610
## 5    22       175       99 12182   13265       1278     3922      1541
## 6   196      1107      654 46229   50555       5261    14141      8160
##   AGE_22_29 AGE_30_39 AGE_40_49 AGE_50_64 AGE_65_UP MED_AGE MED_AGE_M MED_AGE_F
## 1      1483      2085      2299      2765      2420    38.7      37.3      40.0
## 2      7945     12183     11984     12240      8466    35.8      35.3      36.3
## 3      2757      3246      4406      4473      3464    38.8      37.8      39.7
## 4      1426      2049      2322      2619      2330    39.6      38.8      40.5
## 5      2249      3221      4038      4536      4662    41.2      39.6      42.7
## 6     11725     12236     13893     15869     15499    37.5      35.6      39.4
##   HOUSEHOLDS AVE_HH_SZ HSEHLD_1_M HSEHLD_1_F MARHH_CHD MARHH_NO_C MHH_CHILD
## 1       6123      2.47        638        896      1399       2101       122
## 2      29569      2.53       3376       3785      7035       9118       894
## 3      10291      2.47       1030       1499      2419       3495       242
## 4       5771      2.46        638        814      1325       1980       133
## 5      10396      2.36       1104       1801      2130       3621       167
## 6      41180      2.27       5247       7652      7237      12140       619
##   FHH_CHILD FAMILIES AVE_FAM_SZ HSE_UNITS URBAN RURAL VACANT OWNER_OCC
## 1       320     4367       2.94      7348     0     0   1225      4815
## 2      1960    20702       2.99     32913     0     0   3344     21927
## 3       541     7464       2.92     11575     0     0   1284      8122
## 4       289     4099       2.92      7374     0     0   1603      4511
## 5       504     7156       2.88     11150     0     0    754      7971
## 6      2535    25474       2.85     45615     0     0   4435     26591
##   RENTER_OCC Mines15 AveEmp15   Wages15 AveWkWg15 WgEmp15 MedInc15 AgMnJb15
## 1       1308      NA       NA        NA        NA      NA    37066      6.2
## 2       7642      NA       NA        NA        NA      NA    55239      1.2
## 3       2169      15     1296 102248050      1517   78905    39958     23.4
## 4       1260      NA       NA        NA        NA      NA    32750     10.5
## 5       2425      NA       NA        NA        NA      NA    46215      1.7
## 6      14589      NA       NA        NA        NA      NA    38344      1.0
##                         geometry
## 1 POLYGON ((592517.2 4313786,...
## 2 POLYGON ((754483.2 4389441,...
## 3 POLYGON ((433341.3 4230981,...
## 4 POLYGON ((506432.2 4269583,...
## 5 POLYGON ((527478.5 4448095,...
## 6 POLYGON ((394905.6 4271170,...</code></pre>
<p>Great!</p>
</div>
<div id="mapping-in-r" class="section level2">
<h2><span class="header-section-number">5.7</span> Mapping in R</h2>
<p>There are multiple libraries that exist for mapping in R. We will use <code>tmap</code> and to a lesser extent,<code>ggplot</code> in this lab. Let’s start with <code>tmap.</code></p>
<p>First, we need to add the libraries. Install the libraries if you have not done so.</p>
<div id="load-packages" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Load packages</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tmap)
<span class="kw">library</span>(RColorBrewer)</code></pre></div>
</div>
<div id="view-palette-options" class="section level3">
<h3><span class="header-section-number">5.7.2</span> View palette options</h3>
<p>It is helpful to have a nice range of color palette options when mapping in R. Load the <code>RColorBrewer</code> library and display all the options available to you. Each palette option has a name attached – the is the name that you indicate as a parameter for mapping in <code>tmap.</code></p>
<p>While this appears “squished” when rendered via RMarkdown, you can expand the view when run via your Console or via R script.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Display the color palette</span>
<span class="kw">display.brewer.all</span>()</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="basic-tmap-functions" class="section level3">
<h3><span class="header-section-number">5.7.3</span> Basic tmap functions</h3>
<p>For basic mapping in R using <code>tmap</code>, you have two functions for each variable you need to map. Obviously the data needs to be the spatial file you’ve generated and loaded into the environment. Our Master spatial file is named “WV_county” in our setting here. To visualize the “AgMnJb15” variable (our ACS mining proxy) we add this to the <code>tm_fill</code> parameter. This generates a default choropleth map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Creates a simple choropleth map of our a AgMnJb15 variable</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-13-1.png" width="672" /> While this is not a perfect proxy for mining jobs, some of the patterns are consistent with the BLS data source. We can see that majority of jobs in this dataset are in the Southern part of West Viriginia, in the same area as the highest proportions of coal mining jobs. What areas are less well represented? Why may that be the case?</p>
</div>
<div id="set-color-palette" class="section level3">
<h3><span class="header-section-number">5.7.4</span> Set color palette</h3>
<p>With ColorBrewer, we can switch palettes. If you would like to change the direction of the palette, just add a “negative” sign.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setting a color palette</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;-BrBG&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="classify-data" class="section level3">
<h3><span class="header-section-number">5.7.5</span> Classify data</h3>
<p>You can also change the data classification interval. It defaults on a “pretty classification” which has been optimized for easy-to-read breaks, but may not best reflect the actual data distribution To see different parameter options, research the <code>tmap</code> documentation page.</p>
<p>Here we try quantile breaks, and then specific the number of levels or breaks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># changing the intervals </span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;quantile&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;-BrBG&quot;</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># number of levels</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;quantile&quot;</span>, <span class="dt">n =</span> <span class="dv">7</span>, <span class="dt">palette =</span> <span class="st">&quot;-BrBG&quot;</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<p>How does this change your interpretation? Try additional parameter specifications like “jenks” for jenks breaks, or “sd” for standard deviation breaks.</p>
</div>
<div id="customize-maps" class="section level3">
<h3><span class="header-section-number">5.7.6</span> Customize Maps</h3>
<p>There are multiple other options when designing maps using <code>tmap.</code> Many of these are best optimized for generating in an R script directly, rather than in an RMarkdown, as RStudio can enforce odd behaviors when it doesn’t have full space to generate plots. Take the following code as examples for what you should try in your own RStudio environment within an R script (rather than an RMarkdown file).</p>
<p>Finally, experiment with the parameters here, and continue to explore the tmap documentation. (Google search terms: “tmap R” to get information directly.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># includes a histogram in the legend</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">n=</span><span class="dv">6</span>, <span class="dt">palette =</span> <span class="st">&quot;-BrBG&quot;</span>, <span class="dt">legend.hist =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add borders</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">n=</span><span class="dv">6</span>, <span class="dt">palette =</span> <span class="st">&quot;-BrBG&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha=</span>.<span class="dv">4</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># north arrow</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">n=</span><span class="dv">6</span>, <span class="dt">palette =</span> <span class="st">&quot;-BrBG&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha=</span>.<span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_compass</span>()</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># adds in layout, gets rid of frame</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;-BrBG&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;% Jobs High Risk Employment&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha=</span>.<span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_compass</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.text.size =</span> <span class="fl">1.1</span>, <span class="dt">legend.title.size =</span> <span class="fl">1.5</span>, <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="dt">frame =</span> <span class="ot">FALSE</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-4.png" width="672" /></p>
</div>
<div id="facet-mapping" class="section level3">
<h3><span class="header-section-number">5.7.7</span> Facet mapping</h3>
<p>Now that we have a Master spatial dataset that includes both mining job proxies, we can compare them. How close is the mining proxy data from the ACS profile to the actual mining employment numbers from BLS? To do this we generate a “facet map” meaning we show multiple maps, side by side.</p>
<p>We first assign each map to a variable, and then use either <code>tmap_arrange</code> or <code>tm_facets</code> to generate our facet maps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ReMap</span>
BLSData &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AveEmp15&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;BuPu&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Coal Mng Jobs&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha=</span>.<span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.text.size =</span> .<span class="dv">8</span>, <span class="dt">legend.title.size =</span> <span class="fl">1.0</span>, <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="dt">frame =</span> <span class="ot">FALSE</span>) 

ACSData &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(WV_county) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;AgMnJb15&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;BuPu&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;High Risk Job %&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha=</span>.<span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.text.size =</span> .<span class="dv">8</span>, <span class="dt">legend.title.size =</span> <span class="fl">1.0</span>, <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="dt">frame =</span> <span class="ot">FALSE</span>) 

<span class="kw">tmap_arrange</span>(BLSData,ACSData)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Here’s another way to generate the maps side by side:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Another Route:</span>
<span class="kw">tm_shape</span>(WV_county) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_polygons</span>(<span class="kw">c</span>(<span class="st">&quot;AveEmp15&quot;</span>, <span class="st">&quot;AgMnJb15&quot;</span>), 
              <span class="dt">style=</span><span class="kw">c</span>(<span class="st">&quot;jenks&quot;</span>, <span class="st">&quot;jenks&quot;</span>),
              <span class="dt">palette=</span><span class="kw">list</span>(<span class="st">&quot;BuPu&quot;</span>, <span class="st">&quot;BuPu&quot;</span>),
              <span class="dt">title=</span><span class="kw">c</span>(<span class="st">&quot;Coal Mng Jobs&quot;</span>, <span class="st">&quot;High Risk Jobs %&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_facets</span>(<span class="dt">ncol=</span><span class="dv">2</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Obviously the ACS data is overestimating in some areas, and undestimating in others. While it captures the increase in mining jobs in the Southermost area, it misses the county with the highest mining jobs when considering all the other employment categories included. Getting finer resolution data for coal mining below county may not be available, but at least we know relatively how useful this Census category is.</p>
</div>
</div>
<div id="using-a-census-api" class="section level2">
<h2><span class="header-section-number">5.8</span> Using a Census API</h2>
<p>In this lab I provided the raw data to you for 2015 that you wrangled and cleaned. Another excellent option in R coding environments is using a package to extract Census data for you. While you won’t be able to access all the data the same way, for some of the “classic” indicators like population demographics and income, using the Census API is the most efficient approach.</p>
<p>Let’s extract median income for WV counties and census tracts to see if we gain any insight into our analysis.</p>
<div id="workspace-setup" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Workspace Setup</h3>
<p>Examples in this section were sourced from Kyle Walker’s guide to using tidycensus: <a href="https://walkerke.github.io/tidycensus/articles/basic-usage.html">Basic Usage of tidycensus</a> and <a href="https://walkerke.github.io/tidycensus/articles/spatial-data.html">Spatial Data in tidycensus</a>. If you run into challengs, feel free to peruse the original context for more ideas.</p>
</div>
<div id="load-libraries-1" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Load libraries</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(tidycensus)
<span class="kw">options</span>(<span class="dt">tigris_use_cache =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="activate-your-api-key" class="section level3">
<h3><span class="header-section-number">5.8.3</span> Activate your API key</h3>
<p>To work with tidycensus, you must first register for and activate your Census API key. A key can be obtained from <a href="http://api.census.gov/data/key_signup.html" class="uri">http://api.census.gov/data/key_signup.html</a>. Register and activate your API key.</p>
<p>Next, add your API key to your RStudio coding environment. This should be done in your console or your personal file; the API key should not be shared. I include dummy code below that has been commented out. For my implementation to work, I needed to add two additional parameters after simple debugging.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#census_api_key(&quot;YOURAPIKEY&quot;, install=TRUE, overwrite = TRUE)</span></code></pre></div>
<p>Using the documentation for tidycensus by Kyle Walker, we first load variables from the ACS 5-year estimated for 2015 (so from years 2011-2015). The “view” option opens a window in your RStudio environment where you can explore the Census variables available to you in detail. This is how you can find the definitions of the variables of interest, using the search functionality availble in RStudio. See the Kyle Walker demo for more specifics.</p>
<p>The <code>view(ACS15var)</code> call is a critical component to using tidycensus. This lets you explore all the available options to you when extracting variables, serving as a metadata file. Use the “search” function in RStudio to explore this dataset after it opens. Try searching for “income” for example – how many options are available to you? Uncomment and explore!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ACS15var &lt;-<span class="st"> </span><span class="kw">load_variables</span>(<span class="dv">2015</span>, <span class="st">&quot;acs5&quot;</span>, <span class="dt">cache =</span> <span class="ot">TRUE</span>)
<span class="co">#view(ACS15var)</span></code></pre></div>
</div>
<div id="extract-census-data" class="section level3">
<h3><span class="header-section-number">5.8.4</span> Extract Census data</h3>
<p>Next we can extract the exact data. This functions gathers data for median income levels for all counties in West Virginia, using the 2015 dataset.</p>
<p><em>Note:</em> this call can take some time to pull. It’s not necessary to go through for the lab, so it’s okay to skip if you are running into issues.</p>
</div>
<div id="access-census-estimates" class="section level3">
<h3><span class="header-section-number">5.8.5</span> Access census estimates</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_county_medinc &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&quot;county&quot;</span>, 
              <span class="dt">variables =</span> <span class="kw">c</span>(<span class="dt">medincome =</span> <span class="st">&quot;B19013_001&quot;</span>), 
              <span class="dt">state =</span> <span class="st">&quot;WV&quot;</span>, 
              <span class="dt">year =</span> <span class="dv">2015</span>)</code></pre></div>
<pre><code>## Getting data from the 2011-2015 5-year ACS</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_county_medinc</code></pre></div>
<pre><code>## # A tibble: 55 x 5
##    GEOID NAME                            variable  estimate   moe
##    &lt;chr&gt; &lt;chr&gt;                           &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
##  1 54001 Barbour County, West Virginia   medincome    37066  2601
##  2 54003 Berkeley County, West Virginia  medincome    55239  1628
##  3 54005 Boone County, West Virginia     medincome    39958  2871
##  4 54007 Braxton County, West Virginia   medincome    32750  4420
##  5 54009 Brooke County, West Virginia    medincome    46215  2259
##  6 54011 Cabell County, West Virginia    medincome    38344  1905
##  7 54013 Calhoun County, West Virginia   medincome    35568  6515
##  8 54015 Clay County, West Virginia      medincome    31325  3298
##  9 54017 Doddridge County, West Virginia medincome    39974  4623
## 10 54019 Fayette County, West Virginia   medincome    36293  1836
## # … with 45 more rows</code></pre>
</div>
<div id="access-merged-spatial-file" class="section level3">
<h3><span class="header-section-number">5.8.6</span> Access merged spatial file</h3>
<p>The latest edition of <code>tidycensus</code> adds the ability to extract census attribute data with the spatial data already merged. The object is thus a spatial file, not a simple data file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_county_medinc.sp &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">state =</span> <span class="st">&quot;WV&quot;</span>, 
                     <span class="dt">geography =</span> <span class="st">&quot;county&quot;</span>, 
                     <span class="dt">variables =</span> <span class="st">&quot;B19013_001&quot;</span>, 
                     <span class="dt">geometry =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Getting data from the 2014-2018 5-year ACS</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(WV_county_medinc.sp)</code></pre></div>
<pre><code>## Simple feature collection with 6 features and 5 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -82.50768 ymin: 37.76331 xmax: -77.82356 ymax: 40.39976
## CRS:            4269
##   GEOID                           NAME   variable estimate  moe
## 1 54001  Barbour County, West Virginia B19013_001    39580 4632
## 2 54003 Berkeley County, West Virginia B19013_001    60615 1882
## 3 54005    Boone County, West Virginia B19013_001    38642 3787
## 4 54007  Braxton County, West Virginia B19013_001    42213 5363
## 5 54009   Brooke County, West Virginia B19013_001    49772 3595
## 6 54011   Cabell County, West Virginia B19013_001    38321 1341
##                         geometry
## 1 MULTIPOLYGON (((-80.22631 3...
## 2 MULTIPOLYGON (((-78.22901 3...
## 3 MULTIPOLYGON (((-81.97956 3...
## 4 MULTIPOLYGON (((-80.98495 3...
## 5 MULTIPOLYGON (((-80.6796 40...
## 6 MULTIPOLYGON (((-82.50768 3...</code></pre>
</div>
<div id="plot-data" class="section level3">
<h3><span class="header-section-number">5.8.7</span> Plot data</h3>
<p>Using Walker’s <code>tidycensus</code> vignette, you can quickly plot the data using <code>ggplot</code>. We didn’t need to install <code>ggplot</code> because it was part of the <code>tidyverse</code> library.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_county_medinc.sp <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> estimate)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">color =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;magma&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Of course, you can also plot using <code>tmap.</code> Note that the variable of interest is called “estimate” here, using the <code>tidycensus</code> default. I recommend just working with one attribute at a time when first working with <code>tidycensus</code> and R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(WV_county_medinc.sp) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;estimate&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;BuPu&quot;</span>, <span class="dt">title =</span><span class="st">&quot;Median Income&quot;</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="rinse-and-repeat" class="section level3">
<h3><span class="header-section-number">5.8.8</span> Rinse and Repeat</h3>
<p>What’s nice about <code>tidycensus</code> is that we can quickly run the same function to get the spatial data at a different resolution. Here we can gather median income information at the tract level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_tracts_medinc.sp &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">state =</span> <span class="st">&quot;WV&quot;</span>, 
                     <span class="dt">geography =</span> <span class="st">&quot;tract&quot;</span>, 
                     <span class="dt">variables =</span> <span class="st">&quot;B19013_001&quot;</span>, 
                     <span class="dt">geometry =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Getting data from the 2014-2018 5-year ACS</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(WV_tracts_medinc.sp)</code></pre></div>
<pre><code>## Simple feature collection with 6 features and 5 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -80.22717 ymin: 38.94724 xmax: -77.82975 ymax: 39.61915
## CRS:            4269
##         GEOID                                                 NAME   variable
## 1 54001965500     Census Tract 9655, Barbour County, West Virginia B19013_001
## 2 54001965600     Census Tract 9656, Barbour County, West Virginia B19013_001
## 3 54001965700     Census Tract 9657, Barbour County, West Virginia B19013_001
## 4 54001965800     Census Tract 9658, Barbour County, West Virginia B19013_001
## 5 54003971101 Census Tract 9711.01, Berkeley County, West Virginia B19013_001
## 6 54003971102 Census Tract 9711.02, Berkeley County, West Virginia B19013_001
##   estimate   moe                       geometry
## 1    47092  5751 MULTIPOLYGON (((-80.22631 3...
## 2    26429  8650 MULTIPOLYGON (((-80.10631 3...
## 3    41029 11601 MULTIPOLYGON (((-80.07606 3...
## 4    33929  8376 MULTIPOLYGON (((-79.98156 3...
## 5    58643 14597 MULTIPOLYGON (((-77.92404 3...
## 6    66392 10805 MULTIPOLYGON (((-77.9613 39...</code></pre>
<p>Next, we can plot it using both <code>ggplot</code> and <code>tmap.</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_tracts_medinc.sp <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> estimate)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">color =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;magma&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(WV_tracts_medinc.sp) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;estimate&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;BuPu&quot;</span>, <span class="dt">title =</span><span class="st">&quot;Median Income&quot;</span>)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>What new insights did you find?</p>
</div>
</div>
<div id="scale-of-coal-mining" class="section level2">
<h2><span class="header-section-number">5.9</span> Scale of Coal Mining</h2>
<p>Finally – so, what about the scale of coal mining in West Virginia? While we know the ACS data is an imperfect represetnation of coal mining the state, we also know it captures some of the higher proportions of mining employment, especially in the Southern part of the state.</p>
<p>After exploring the “view” of the ACS data pulled, the closest variable I could find was B24031_002 - or the “Estimate of total persons in Agriculture, forestry, fishing and hunting, and mining.” The ACS profile used in <code>tidycensus</code> does not link directly to the specific report we need to match our analysis exactly, but this should capture some of the same variation.</p>
<p>Thus, let’s map this variable at County and Tract scales to look for some patterns.</p>
<div id="extract-data" class="section level3">
<h3><span class="header-section-number">5.9.1</span> Extract Data</h3>
<p>First, we extract the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_county_mining.sp &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">state =</span> <span class="st">&quot;WV&quot;</span>, 
                     <span class="dt">geography =</span> <span class="st">&quot;county&quot;</span>, 
                     <span class="dt">variables =</span> <span class="st">&quot;B24031_002&quot;</span>, 
                     <span class="dt">geometry =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Getting data from the 2014-2018 5-year ACS</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WV_tracts_mining.sp &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">state =</span> <span class="st">&quot;WV&quot;</span>, 
                     <span class="dt">geography =</span> <span class="st">&quot;tract&quot;</span>, 
                     <span class="dt">variables =</span> <span class="st">&quot;B24031_002&quot;</span>, 
                     <span class="dt">geometry =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Getting data from the 2014-2018 5-year ACS</code></pre>
</div>
<div id="map-data" class="section level3">
<h3><span class="header-section-number">5.9.2</span> Map Data</h3>
<p>Next, we map both side by side:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ReMap</span>
WVCounties &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(WV_county_mining.sp) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;estimate&quot;</span>, <span class="dt">n=</span><span class="dv">4</span>, <span class="dt">palette =</span> <span class="st">&quot;BuPu&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;High Risk Jobs&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha=</span>.<span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.text.size =</span> .<span class="dv">8</span>, <span class="dt">legend.title.size =</span> <span class="fl">1.0</span>, <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="dt">frame =</span> <span class="ot">FALSE</span>) 

WVTracts &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(WV_tracts_mining.sp) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;estimate&quot;</span>, <span class="dt">n=</span><span class="dv">4</span>, <span class="dt">palette =</span> <span class="st">&quot;BuPu&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;High Risk Jobs&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">alpha=</span>.<span class="dv">4</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.text.size =</span> .<span class="dv">8</span>, <span class="dt">legend.title.size =</span> <span class="fl">1.0</span>, <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="dt">frame =</span> <span class="ot">FALSE</span>) 

<span class="kw">tmap_arrange</span>(WVCounties,WVTracts)</code></pre></div>
<pre><code>## Some legend labels were too wide. These labels have been resized to 0.73. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
</div>
<div id="interpretation" class="section level2">
<h2><span class="header-section-number">5.10</span> Interpretation</h2>
<p>What type of variation do you find between these maps? Knowing that there is more connection with mining in th Southern area, were you suprised by the variation below the county level? At what scale is coal mining employment occurring? Broadening to a wider “High Risk Employment” category for jobs that are more prone to accidents (including construction, mining, agricultural, etc) captured in this Census variable, what additional insights might you have?</p>
<p>Note that this variable is sometimes used for identifying areas at risk for opioid overdose. If some jobs are more prone to injury, then workers could also be more prone to getting prescription opioids for pain management, a component of the opioid epidemic. At the same time, these areas often have few other job options. When high-paying coal mining jobs go away (“high” relative to median income in the area), there may not be other options that promise the same pay and/or stability. This “economics of despair” concept likewise is thought the drive increases in opioid-related overdoses. Consider the complexity here – and how might you further detangle these concepts?</p>
</div>
<div id="appendix" class="section level2">
<h2><span class="header-section-number">5.11</span> Appendix</h2>
<div id="write-to-csv" class="section level3">
<h3><span class="header-section-number">5.11.1</span> Write to CSV</h3>
<p>After all the hard work in this analysis, you’ll want to save the master files you generated. One option is to save the attribute component of the data you generated, using a <code>CSV</code> file. Uncomment and run on your own.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># write.csv(WV_county, &quot;WV_county.csv&quot;)</span></code></pre></div>
</div>
<div id="write-to-shp" class="section level3">
<h3><span class="header-section-number">5.11.2</span> Write to SHP</h3>
<p>The <code>st_write</code> function saves the spatial file as a <code>shapefile.</code> For example you can save the county file you updated earlier. Uncomment and run on your own. The file is save to your working directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># st_write(WV_county, &quot;WV_county.shp&quot;)</span></code></pre></div>
</div>
<div id="census-data-access" class="section level3">
<h3><span class="header-section-number">5.11.3</span> Census Data Access</h3>
<p>While the <code>tidycensus</code> package is great for straightforward variables like income level, it may not always be for all variables. For example, if we search for “mining” in the existing View only a small selection is returned. We could for example try variable “B08126_002” corresponding to the total estimate of persons in Agriculture, forestry, fishing and hunting, and mining industries, but this is not the percentage of the workforce in these industries (which would be more precise). Rather than calculate this on our own (which also needs to account for the total able-to-work population), it’s more efficient to use pre-calculated Census metrics.</p>
<p>I thus recommend that for more detailed Census explorations, you take the time to get familiar with various Census data profiles.</p>
<p>For your own research, I recommend investigating <a href="https://ipums.org/">IPUMS</a> and the newly revised <a href="https://www.data.gov/">Data.gov</a> site that releases more detailed Census profiles with ther required metadata components. The previous version, American Factfinder, has been retired.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lab-3-principles-of-spatial-scale-part-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lab-5-modeling-neighborhoods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
